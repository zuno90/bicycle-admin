import{aj as O,g as V,ak as K,al as z,i as P,O as Q,u as U,a as X,b as Z,c as G,k as I,R as F,j as e,L,P as M,n as g,E as p,e as J}from"./index-16a23a48.js";import{P as W}from"./Pagination-28b96b22.js";import{c,q as Y,u as q,a as $}from"./base-c0ef439a.js";import{a as _}from"./category.query-6a82e8cd.js";import{u as ee,F as A,a as E}from"./index.esm-288f1c50.js";import{M as B}from"./Modal-db659ea6.js";const te=async s=>await O(`${c.endpoint}/sub-category`,s,{Authorization:`Bearer ${V(c.cache.accessToken)}`}),se=async s=>await K(`${c.endpoint}/sub-category/${s.id}`,s.payload,{Authorization:`Bearer ${V(c.cache.accessToken)}`}),ae=async s=>await z(`${c.endpoint}/sub-category/${s}`,JSON.stringify({}),{Authorization:`Bearer ${V(c.cache.accessToken)}`}),re=async(s,i,b)=>{const f=Y.stringify({page:s,limit:i},{skipNull:!0,skipEmptyString:!0}),n=await P(`${c.endpoint}/sub-category/category/${b}?${f}`,{Authorization:`Bearer ${V(c.cache.accessToken)}`});if(n.success)return n.data},ne=async s=>{const i=await P(`${c.endpoint}/sub-category/${s}`,{Authorization:`Bearer ${V(c.cache.accessToken)}`});if(i.success)return i.data.subCategory},R="Ảnh danh mục phụ không được bỏ trống!",xe=({title:s})=>{var l,S,o;const{id:i}=Q(),{search:b}=U(),f=X(),n=Z(a=>a.common),y=G(),H=I(),k=ee(),[j,w]=F.useState(""),v=new URLSearchParams(b),d=Number(v.get("page"))||c.pagination.PAGE,m=Number(v.get("limit"))||c.pagination.LIMIT,t=q({queryKey:["category"],queryFn:()=>_(Number(i))}),u=q({queryKey:["subCategories",{page:d,limit:m}],queryFn:()=>re(d,m,Number(i)),enabled:!t.isLoading&&!t.isError&&t.isFetched}),N=u.data&&u.data.totalSubCategory,h=()=>{k.reset(),y(J())},{mutate:C}=$(ae,{onSuccess:a=>{a.success?(H.invalidateQueries({queryKey:["subCategories",{page:d,limit:m}]}),g(p.success,"Xoá danh mục con thành công!")):g(p.error,"Xảy ra lỗi! Không thể xoá danh mục con!")}}),r=()=>e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-meta-1 italic",children:"Các sản phẩm thuộc danh mục con này sẽ bị xoá!"}),e.jsx("p",{children:"Bạn vẫn muốn xoá danh mục này?"})]}),x=()=>e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"inline-flex w-full justify-center rounded-md bg-[#DDDDDD] text-black px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-[#B6B6B6] hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:h,children:"Huỷ"}),e.jsx("button",{type:"button",className:"inline-flex w-full justify-center rounded-md bg-primary text-white px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:()=>{C(n.modalId),h()},children:"Xác nhận"})]});return(t.isError||u.isError)&&f(-1),t.isLoading?e.jsx(L,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-10 mb-6",children:e.jsxs("div",{className:"w-full inline-flex items-center justify-between",children:[e.jsxs("h4",{className:"text-xl font-semibold text-black dark:text-white",children:[s," ",">"," ",(l=t.data)==null?void 0:l.name]}),e.jsx("div",{className:"inline-flex items-center gap-4",children:e.jsxs("button",{type:"button",className:"text-black bg-[#FBE69E] hover:bg-[#FFC700]/90 focus:ring-2 focus:outline-none focus:ring-[#FFC700]/50 font-medium rounded-lg text-xs px-5 py-2.5 text-center inline-flex items-center dark:focus:ring-[#3b5998]/55",onClick:()=>{w("create"),y(M({id:0,isOpen:!0}))},children:["Tạo danh mục phụ",e.jsx("svg",{className:"w-4 h-4 ml-4","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"})})]})})]})}),u.isRefetching?e.jsx(L,{loadInside:!0}):e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"grid grid-cols-4 border-stroke py-4 dark:border-strokedark sm:grid-cols-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("h5",{className:"text-sm font-bold xsm:text-base",children:"Hình ảnh"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h5",{className:"text-sm font-bold xl:text-base",children:"Danh mục phụ"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h5",{className:"text-sm text-center font-bold xl:text-base",children:"Số lượng sản phẩm"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h5",{className:"text-sm text-center font-bold xsm:text-base",children:"Hành động"})})]}),((S=u.data)==null?void 0:S.subCategories.length)>0&&((o=u.data)==null?void 0:o.subCategories.map(a=>e.jsxs("div",{className:"grid grid-cols-4 border-t border-stroke py-4 dark:border-strokedark sm:grid-cols-4",children:[e.jsx("img",{className:"col-span-1 w-14 rounded-md",src:a.thumbnail,alt:"subCategory"}),e.jsx("div",{className:"flex flex-col gap-2 justify-center",children:e.jsx("p",{className:"text-xs font-semibold text-black dark:text-white text-ellipsis overflow-hidden",children:a.name})}),e.jsx("div",{className:"col-span-1 flex justify-center items-center",children:e.jsx("p",{className:"text-xs text-center text-black dark:text-white",children:a.totalProduct})}),e.jsxs("div",{className:"col-span-1 inline-flex items-center justify-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{w("update"),y(M({id:a.id,isOpen:!0}))},className:"hover:text-primary",children:e.jsx("svg",{className:"fill-current",width:24,height:24,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M5,3C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19H5V5H12V3H5M17.78,4C17.61,4 17.43,4.07 17.3,4.2L16.08,5.41L18.58,7.91L19.8,6.7C20.06,6.44 20.06,6 19.8,5.75L18.25,4.2C18.12,4.07 17.95,4 17.78,4M15.37,6.12L8,13.5V16H10.5L17.87,8.62L15.37,6.12Z"})})}),e.jsx("button",{type:"button",onClick:()=>{w("remove"),y(M({id:a.id,isOpen:!0}))},className:"hover:text-primary",children:e.jsx("svg",{className:"fill-current",width:24,height:24,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"})})})]})]},a.id))),N>0&&e.jsx("div",{className:"flex justify-center items-center my-4",children:e.jsx(W,{page:d,limit:m,total:N})}),n.isOpenModal&&j==="create"&&n.modalId===0&&e.jsx(A,{...k,children:e.jsx(B,{title:"Tạo danh mục phụ",body:e.jsx(ie,{cateId:t.data.id,cateName:t.data.name,close:h,page:d,limit:m}),isForm:!0})}),n.isOpenModal&&j==="update"&&n.modalId>0&&e.jsx(A,{...k,children:e.jsx(B,{title:"Cập nhật danh mục phụ",body:e.jsx(oe,{id:n.modalId,cateId:t.data.id,cateName:t.data.name,close:h,page:d,limit:m}),isForm:!0})}),n.isOpenModal&&j==="remove"&&n.modalId>0&&e.jsx(B,{title:"Xoá danh mục",body:e.jsx(r,{}),footer:e.jsx(x,{}),close:h})]})]})},ie=({cateId:s,cateName:i,close:b,page:f,limit:n})=>{const y=I(),{register:H,trigger:k,handleSubmit:j,formState:{errors:w}}=E(),[v,d]=F.useState(null),[m,t]=F.useState(""),u=r=>{if(r.target.files){d(r.target.files[0]);const x=new FileReader;x.onload=()=>t(x.result),x.readAsDataURL(r.target.files[0])}},{mutate:N,isLoading:h}=$(te,{onSuccess:r=>{r.success?(g(p.success,"Tạo mới danh mục phụ thành công!","success"),y.invalidateQueries({queryKey:["subCategories",{page:f,limit:n}]}),b()):g(p.error,r.message)}}),C=async r=>{const{name:x}=r,l=new FormData;l.append("categoryId",s),l.append("name",x),l.append("thumbnail",v),N(l)};return e.jsxs("form",{onSubmit:async r=>{var l;if(r.preventDefault(),!await k())for(let S in w)return g(p.error,(l=w[S])==null?void 0:l.message);if(!v)return g(p.error,R);j(C)()},children:[e.jsxs("div",{className:"w-full flex flex-col justify-between bg-white dark:bg-form-strokedark p-4 gap-8 leading-normal",children:[e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsx("p",{className:"w-1/4 text-sm text-left",children:"Tên danh mục chính"}),e.jsx("input",{type:"text",defaultValue:i,disabled:!0,className:"w-full rounded-lg border-[1.5px] border-stroke bg-gray py-3 px-5 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"})]}),e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Tên danh mục phụ ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsx("input",{...H("name",{required:"Tên danh mục phụ không được bỏ trống"}),type:"text",className:"w-full rounded-lg border-[1.5px] border-stroke bg-gray py-3 px-5 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"})]}),e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Hình ảnh ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsxs("div",{className:"w-full inline-flex items-center gap-4",children:[m&&e.jsx("img",{src:m,className:"w-16 h-16",alt:"preview-thumb"}),e.jsxs("label",{htmlFor:"create-cate",className:"px-3 py-1 rounded-lg bg-primary text-white",children:["Tải ảnh",e.jsx("input",{type:"file",onChange:u,id:"create-cate",className:"sr-only"})]})]})]})]}),e.jsxs("div",{className:"mt-10 inline-flex items-center gap-4",children:[e.jsx("button",{type:"button",onClick:b,className:"inline-flex w-full justify-center rounded-md bg-[#DDDDDD] text-black px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-[#B6B6B6] hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Huỷ"}),e.jsx("button",{type:"submit",disabled:h,className:"inline-flex w-full justify-center rounded-md bg-primary text-white px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Tạo danh mục"})]})]})},oe=({id:s,cateId:i,cateName:b,close:f,page:n,limit:y})=>{const H=I(),{register:k,setValue:j,trigger:w,handleSubmit:v,formState:{errors:d}}=E(),m=o=>{if(o.target.files){h(o.target.files[0]);const a=new FileReader;a.onload=()=>r(a.result),a.readAsDataURL(o.target.files[0])}},{data:t,isLoading:u}=q({queryKey:["subcategory",{id:s}],queryFn:()=>ne(Number(s))}),[N,h]=F.useState(),[C,r]=F.useState("");F.useEffect(()=>{t&&(j("name",t.name,{shouldDirty:!0}),j("thumbnail",t.thumbnail,{shouldDirty:!0}),r(t.thumbnail))},[t]);const{mutate:x,isLoading:l}=$(se,{onSuccess:o=>{o.success?(g(p.success,"Cập nhật danh mục phụ thành công!","success"),H.invalidateQueries({queryKey:["subCategories",{page:n,limit:y}]}),f()):g(p.error,o.message)}}),S=async o=>{const{name:a,thumbnail:T}=o,D=new FormData;D.append("categoryId",i.toString()),D.append("name",a),D.append("thumbnail",N?null:T),D.append("newThumbnail",N),x({id:s,payload:D})};return u?e.jsx(L,{loadInside:!0}):e.jsxs("form",{onSubmit:async o=>{var T;if(o.preventDefault(),!await w())for(let D in d)return g(p.error,(T=d[D])==null?void 0:T.message);if(!C&&!N)return g(p.error,R);v(S)()},children:[e.jsxs("div",{className:"w-full flex flex-col justify-between bg-white dark:bg-form-strokedark p-4 gap-8 leading-normal",children:[e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsx("p",{className:"w-1/4 text-sm text-left",children:"Tên danh mục chính"}),e.jsx("input",{type:"text",defaultValue:b,disabled:!0,className:"w-full rounded-lg border-[1.5px] border-stroke bg-gray py-3 px-5 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"})]}),e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Tên danh mục ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsx("input",{...k("name",{required:"Tên danh mục không được bỏ trống",value:t&&t.name}),type:"text",className:"w-full rounded-lg border-[1.5px] border-stroke bg-gray py-3 px-5 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"})]}),e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Hình ảnh ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsxs("div",{className:"w-full inline-flex items-center gap-4",children:[C&&e.jsx("img",{src:C,className:"w-16 h-16",alt:"preview-thumb"}),e.jsxs("label",{htmlFor:"create-cate",className:"px-3 py-1 rounded-lg bg-primary text-white",children:["Tải ảnh",e.jsx("input",{type:"file",onChange:m,id:"create-cate",className:"sr-only"})]})]})]})]}),e.jsxs("div",{className:"mt-10 inline-flex items-center gap-4",children:[e.jsx("button",{type:"button",onClick:()=>{r(""),h(null),f()},className:"inline-flex w-full justify-center rounded-md bg-[#DDDDDD] text-black px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-[#B6B6B6] hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Huỷ"}),e.jsx("button",{type:"submit",disabled:l,className:"inline-flex w-full justify-center rounded-md bg-primary text-white px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Cập nhật danh mục"})]})]})};export{xe as default};
