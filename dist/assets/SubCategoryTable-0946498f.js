import{al as I,g as D,am as P,k as $,P as R,u as K,a as O,b as Q,c as z,m as A,R as S,j as e,L as B,Q as L,n as p,E as g,d as U}from"./index-02f4ac53.js";import{c as i,q as X,u as T,a as E}from"./base-b4bf6111.js";import{a as Z}from"./category.query-b9fb8094.js";import{u as G,F as J,a as W}from"./index.esm-23a6fb82.js";import{M as q}from"./Modal-6c7f5fbc.js";const Y=async a=>await I(`${i.endpoint}/sub-category/${a.id}`,a.payload,{Authorization:`Bearer ${D(i.cache.accessToken)}`}),_=async a=>await P(`${i.endpoint}/sub-category/${a}`,JSON.stringify({}),{Authorization:`Bearer ${D(i.cache.accessToken)}`}),ee=async(a,r,b)=>{const m=X.stringify({page:a,limit:r},{skipNull:!0,skipEmptyString:!0}),n=await $(`${i.endpoint}/sub-category/category/${b}?${m}`,{Authorization:`Bearer ${D(i.cache.accessToken)}`});if(n.success)return n.data},te=async a=>{const r=await $(`${i.endpoint}/sub-category/${a}`,{Authorization:`Bearer ${D(i.cache.accessToken)}`});if(r.success)return r.data.subCategory},se="Ảnh danh mục phụ không được bỏ trống!",le=({title:a})=>{var C,H,V;const{id:r}=R(),{search:b}=K(),m=O(),n=Q(t=>t.common),u=z(),M=A(),k=G(),[y,f]=S.useState(""),N=new URLSearchParams(b),l=Number(N.get("page"))||i.pagination.PAGE,h=Number(N.get("limit"))||i.pagination.LIMIT,s=T({queryKey:["category"],queryFn:()=>Z(Number(r))}),o=T({queryKey:["subCategories",{page:l,limit:h}],queryFn:()=>ee(l,h,Number(r)),enabled:!s.isLoading&&!s.isError&&s.isFetched});o.data&&o.data.totalSubCategory;const c=()=>{k.reset(),u(U())},{mutate:v}=E(_,{onSuccess:t=>{t.success?(M.invalidateQueries({queryKey:["subCategories",{page:l,limit:h}]}),p(g.success,"Xoá danh mục con thành công!")):p(g.error,"Xảy ra lỗi! Không thể xoá danh mục con!")}}),j=()=>e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-meta-1 italic",children:"Các sản phẩm thuộc danh mục con này sẽ bị xoá!"}),e.jsx("p",{children:"Bạn vẫn muốn xoá danh mục này?"})]}),w=()=>e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"inline-flex w-full justify-center rounded-md bg-[#DDDDDD] text-black px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-[#B6B6B6] hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:c,children:"Huỷ"}),e.jsx("button",{type:"button",className:"inline-flex w-full justify-center rounded-md bg-primary text-white px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:()=>{v(n.modalId),c()},children:"Xác nhận"})]});return(s.isError||o.isError)&&m(-1),s.isLoading?e.jsx(B,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-10 mb-4 p-5",children:e.jsxs("div",{className:"w-full inline-flex items-center justify-between",children:[e.jsxs("h4",{className:"text-xl font-semibold text-black dark:text-white",children:[a," ",">"," ",(C=s.data)==null?void 0:C.name]}),e.jsx("div",{className:"inline-flex items-center gap-4",children:e.jsxs("button",{type:"button",className:"text-black bg-[#FBE69E] hover:bg-[#FFC700]/90 focus:ring-2 focus:outline-none focus:ring-[#FFC700]/50 font-medium rounded-lg text-xs px-5 py-2.5 text-center inline-flex items-center dark:focus:ring-[#3b5998]/55",onClick:()=>{f("create"),u(L({id:0,isOpen:!0}))},children:["Tạo danh mục phụ",e.jsx("svg",{className:"w-4 h-4 ml-4","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"})})]})})]})}),o.isRefetching?e.jsx(B,{loadInside:!0}):e.jsx("div",{className:"rounded-sm dark:border-strokedark dark:bg-boxdark",children:e.jsx("div",{className:"max-w-full overflow-x-auto",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-2 text-left dark:bg-meta-4",children:[e.jsx("th",{className:"py-4 px-4 font-medium text-black dark:text-white",children:"Hình ảnh"}),e.jsx("th",{className:"py-4 px-4 font-medium text-black dark:text-white",children:"Danh mục phụ"}),e.jsx("th",{className:"py-4 px-4 text-center font-medium text-black dark:text-white",children:"Số lượng sản phẩm"}),e.jsx("th",{className:"py-4 px-4 text-right font-medium text-black dark:text-white",children:"Hành động"})]})}),e.jsx("tbody",{children:((H=o.data)==null?void 0:H.subCategories.length)>0&&((V=o.data)==null?void 0:V.subCategories.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"border-b border-[#eee] py-5 px-4 dark:border-strokedark",children:e.jsx("img",{className:"col-span-1 w-14 rounded-md",src:t.thumbnail,alt:"subCategory"})}),e.jsx("td",{className:"border-b border-[#eee] py-5 px-4 dark:border-strokedark",children:e.jsx("p",{className:"text-xs font-semibold text-black dark:text-white text-ellipsis overflow-hidden",children:t.name})}),e.jsx("td",{className:"border-b border-[#eee] py-5 px-4 dark:border-strokedark",children:e.jsx("p",{className:"text-xs text-center text-black dark:text-white",children:t.totalProduct})}),e.jsx("td",{className:"border-b border-[#eee] py-5 px-4 dark:border-strokedark",children:e.jsxs("div",{className:"flex justify-end items-center space-x-3.5",children:[e.jsx("button",{type:"button",onClick:()=>{f("update"),u(L({id:t.id,isOpen:!0}))},className:"hover:text-primary",children:e.jsx("svg",{className:"fill-current",width:24,height:24,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M5,3C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19H5V5H12V3H5M17.78,4C17.61,4 17.43,4.07 17.3,4.2L16.08,5.41L18.58,7.91L19.8,6.7C20.06,6.44 20.06,6 19.8,5.75L18.25,4.2C18.12,4.07 17.95,4 17.78,4M15.37,6.12L8,13.5V16H10.5L17.87,8.62L15.37,6.12Z"})})}),e.jsx("button",{type:"button",onClick:()=>{f("remove"),u(L({id:t.id,isOpen:!0}))},className:"hover:text-primary",children:e.jsx("svg",{className:"fill-current",width:24,height:24,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"})})})]})})]},t.id)))})]})})}),n.isOpenModal&&y==="update"&&n.modalId>0&&e.jsx(J,{...k,children:e.jsx(q,{title:"Cập nhật danh mục phụ",body:e.jsx(ae,{id:n.modalId,cateId:s.data.id,cateName:s.data.name,close:c,page:l,limit:h}),isForm:!0})}),n.isOpenModal&&y==="remove"&&n.modalId>0&&e.jsx(q,{title:"Xoá danh mục",body:e.jsx(j,{}),footer:e.jsx(w,{}),close:c})]})},ae=({id:a,cateId:r,cateName:b,close:m,page:n,limit:u})=>{const M=A(),{register:k,setValue:y,trigger:f,handleSubmit:N,formState:{errors:l}}=W(),h=t=>{if(t.target.files){v(t.target.files[0]);const x=new FileReader;x.onload=()=>w(x.result),x.readAsDataURL(t.target.files[0])}},{data:s,isLoading:o}=T({queryKey:["subcategory",{id:a}],queryFn:()=>te(Number(a))}),[c,v]=S.useState(),[j,w]=S.useState("");S.useEffect(()=>{s&&(y("name",s.name,{shouldDirty:!0}),y("thumbnail",s.thumbnail,{shouldDirty:!0}),w(s.thumbnail))},[s]);const{mutate:C,isLoading:H}=E(Y,{onSuccess:t=>{t.success?(p(g.success,"Cập nhật danh mục phụ thành công!","success"),M.invalidateQueries({queryKey:["subCategories",{page:n,limit:u}]}),m()):p(g.error,t.message)}}),V=async t=>{const{name:x,thumbnail:F}=t,d=new FormData;d.append("categoryId",r.toString()),d.append("name",x),d.append("thumbnail",c?null:F),d.append("newThumbnail",c),C({id:a,payload:d})};return o?e.jsx(B,{loadInside:!0}):e.jsxs("form",{onSubmit:async t=>{var F;if(t.preventDefault(),!await f())for(let d in l)return p(g.error,(F=l[d])==null?void 0:F.message);if(!j&&!c)return p(g.error,se);N(V)()},children:[e.jsxs("div",{className:"w-full flex flex-col justify-between bg-white dark:bg-form-strokedark p-4 gap-8 leading-normal",children:[e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsx("p",{className:"w-1/4 text-sm text-left",children:"Tên danh mục chính"}),e.jsx("input",{type:"text",defaultValue:b,disabled:!0,className:"w-full rounded-lg border-[1.5px] border-stroke bg-gray py-3 px-5 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"})]}),e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Tên danh mục ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsx("input",{...k("name",{required:"Tên danh mục không được bỏ trống",value:s&&s.name}),type:"text",className:"w-full rounded-lg border-[1.5px] border-stroke bg-gray py-3 px-5 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"})]}),e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Hình ảnh ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsxs("div",{className:"w-full inline-flex items-center gap-4",children:[j&&e.jsx("img",{src:j,className:"w-16 h-16",alt:"preview-thumb"}),e.jsxs("label",{htmlFor:"create-cate",className:"px-3 py-1 rounded-lg bg-primary text-white",children:["Tải ảnh",e.jsx("input",{type:"file",onChange:h,id:"create-cate",className:"sr-only"})]})]})]})]}),e.jsxs("div",{className:"mt-10 inline-flex items-center gap-4",children:[e.jsx("button",{type:"button",onClick:()=>{w(""),v(null),m()},className:"inline-flex w-full justify-center rounded-md bg-[#DDDDDD] text-black px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-[#B6B6B6] hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Huỷ"}),e.jsx("button",{type:"submit",disabled:H,className:"inline-flex w-full justify-center rounded-md bg-primary text-white px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Cập nhật danh mục"})]})]})};export{le as default};
