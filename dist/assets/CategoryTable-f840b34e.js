import{ak as $,g as T,al as E,am as R,u as O,a as K,b as Q,c as U,m as B,R as D,j as e,L as q,Q as V,n as d,E as m,d as X}from"./index-6ce4062c.js";import{P as z}from"./Pagination-e14b8b4e.js";import{g as Z,a as G}from"./category.query-56dd7619.js";import{c as f,u as A,a as L}from"./base-999044da.js";import{M}from"./Modal-6b0a59b5.js";import{u as J,F as S,a as I}from"./index.esm-024c98d4.js";const W=async r=>await $(`${f.endpoint}/category`,r,{Authorization:`Bearer ${T(f.cache.accessToken)}`}),Y=async r=>await E(`${f.endpoint}/category/${r.id}`,r.payload,{Authorization:`Bearer ${T(f.cache.accessToken)}`}),_=async r=>await R(`${f.endpoint}/category/${r}`,JSON.stringify({}),{Authorization:`Bearer ${T(f.cache.accessToken)}`}),P="Ảnh danh mục không được bỏ trống!",le=({title:r})=>{const{search:u}=O(),N=K(),i=Q(a=>a.common),h=U(),H=B(),x=J(),[g,p]=D.useState(""),y=new URLSearchParams(u),o=Number(y.get("page"))||f.pagination.PAGE,s=Number(y.get("limit"))||f.pagination.LIMIT,{data:b,isLoading:j}=A({queryKey:["categories",{page:o,limit:s}],queryFn:()=>Z(o,s)}),w=b&&b.totalCategory,{mutate:k}=L(_,{onSuccess:a=>{a.success?(H.invalidateQueries({queryKey:["categories",{page:o,limit:s}]}),d(m.success,"Xoá danh mục thành công!")):d(m.error,"Xảy ra lỗi! Không thể xoá danh mục!")}}),t=()=>{x.reset(),h(X())},l=()=>e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-meta-1 italic",children:"Các danh mục con và sản phẩm thuộc danh mục này sẽ bị xoá!"}),e.jsx("p",{children:"Bạn vẫn muốn xoá danh mục này?"})]}),c=()=>e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"inline-flex w-full justify-center rounded-md bg-[#DDDDDD] text-black px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-[#B6B6B6] hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:t,children:"Huỷ"}),e.jsx("button",{type:"button",className:"inline-flex w-full justify-center rounded-md bg-primary text-white px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:()=>{k(i.modalId),t()},children:"Xác nhận"})]});return j?e.jsx(q,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-10 mb-4 p-5",children:e.jsxs("div",{className:"w-full inline-flex items-center justify-between",children:[e.jsx("h4",{className:"text-xl font-semibold text-black dark:text-white",children:r}),e.jsx("div",{className:"inline-flex items-center gap-4",children:e.jsxs("button",{type:"button",className:"text-black bg-[#FBE69E] hover:bg-[#FFC700]/90 focus:ring-2 focus:outline-none focus:ring-[#FFC700]/50 font-medium rounded-lg text-xs px-5 py-2.5 text-center inline-flex items-center dark:focus:ring-[#3b5998]/55",onClick:()=>{p("create"),h(V({id:0,isOpen:!0}))},children:["Tạo danh mục chính",e.jsx("svg",{className:"w-4 h-4 ml-4","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"})})]})})]})}),e.jsx("div",{className:"rounded-sm dark:border-strokedark dark:bg-boxdark",children:e.jsx("div",{className:"max-w-full overflow-x-auto",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-2 text-left dark:bg-meta-4",children:[e.jsx("th",{className:"py-4 px-4 font-medium text-black dark:text-white",children:"Hình ảnh"}),e.jsx("th",{className:"py-4 px-4 font-medium text-black dark:text-white",children:"Danh mục chính"}),e.jsx("th",{className:"py-4 px-4 font-medium text-black dark:text-white",children:"Danh mục phụ"}),e.jsx("th",{className:"py-4 px-4 font-medium text-black dark:text-white",children:"Hành động"})]})}),e.jsx("tbody",{children:b.categories.length>0&&b.categories.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"border-b border-[#eee] py-5 px-4 dark:border-strokedark",children:e.jsx("img",{className:"w-14 rounded-lg cursor-pointer",src:a.thumbnail,alt:"category",onClick:()=>N(`/category/${a.id}`)})}),e.jsx("td",{className:"border-b border-[#eee] py-5 px-4 dark:border-strokedark",children:e.jsx("p",{onClick:()=>N(`/category/${a.id}`),className:"text-xs font-semibold text-black dark:text-white text-ellipsis overflow-hidden cursor-pointer",children:a.name})}),e.jsx("td",{className:"border-b border-[#eee] py-5 px-4 dark:border-strokedark",children:e.jsx("div",{className:"flex items-center gap-1 text-xs",children:a.subCategories.map(n=>e.jsx("button",{type:"button",className:"bg-[#D7D7D7] px-2.5 py-1.5 rounded-full",children:n.name},n.id))})}),e.jsx("td",{className:"border-b border-[#eee] py-5 px-4 dark:border-strokedark",children:e.jsxs("div",{className:"flex justify-center items-center space-x-3.5",children:[e.jsx("button",{type:"button",onClick:()=>{p("update"),h(V({id:a.id,isOpen:!0}))},className:"hover:text-primary",children:e.jsx("svg",{className:"fill-current",width:24,height:24,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M5,3C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19H5V5H12V3H5M17.78,4C17.61,4 17.43,4.07 17.3,4.2L16.08,5.41L18.58,7.91L19.8,6.7C20.06,6.44 20.06,6 19.8,5.75L18.25,4.2C18.12,4.07 17.95,4 17.78,4M15.37,6.12L8,13.5V16H10.5L17.87,8.62L15.37,6.12Z"})})}),e.jsx("button",{type:"button",onClick:()=>{p("remove"),h(V({id:a.id,isOpen:!0}))},className:"hover:text-primary",children:e.jsx("svg",{className:"fill-current",width:24,height:24,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"})})})]})})]},a.id))})]})})}),w>0&&e.jsx("div",{className:"flex justify-center items-center my-4",children:e.jsx(z,{page:o,limit:s,total:w})}),i.isOpenModal&&g==="create"&&i.modalId===0&&e.jsx(S,{...x,children:e.jsx(M,{title:"Tạo danh mục chính",body:e.jsx(ee,{close:t,page:o,limit:s}),isForm:!0})}),i.isOpenModal&&g==="update"&&i.modalId>0&&e.jsx(S,{...x,children:e.jsx(M,{title:"Cập nhật danh mục",body:e.jsx(te,{id:i.modalId,close:t,page:o,limit:s}),isForm:!0})}),i.isOpenModal&&g==="remove"&&i.modalId>0&&e.jsx(M,{title:"Xoá danh mục",body:e.jsx(l,{}),footer:e.jsx(c,{}),close:t})]})},ee=({close:r,page:u,limit:N})=>{const i=B(),{register:h,trigger:H,handleSubmit:x,formState:{errors:g}}=I(),[p,y]=D.useState(),[o,s]=D.useState(""),b=t=>{if(t.target.files){y(t.target.files[0]);const l=new FileReader;l.onload=()=>s(l.result),l.readAsDataURL(t.target.files[0])}},{mutate:j,isLoading:w}=L(W,{onSuccess:t=>{t.success?(d(m.success,"Tạo mới danh mục thành công!","success"),i.invalidateQueries({queryKey:["categories",{page:u,limit:N}]}),r()):d(m.error,t.message)}}),k=async t=>{const{name:l}=t,c=new FormData;c.append("name",l),c.append("thumbnail",p),j(c)};return e.jsxs("form",{onSubmit:async t=>{var c;if(t.preventDefault(),!await H())for(let a in g)return d(m.error,(c=g[a])==null?void 0:c.message);if(!p)return d(m.error,P);x(k)()},children:[e.jsxs("div",{className:"w-full flex flex-col justify-between bg-white dark:bg-form-strokedark p-4 gap-8 leading-normal",children:[e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Tên danh mục ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsx("input",{...h("name",{required:"Tên danh mục không được bỏ trống"}),type:"text",className:"w-full rounded-lg border-[1.5px] border-stroke bg-gray py-3 px-5 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"})]}),e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Hình ảnh ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsxs("div",{className:"w-full inline-flex items-center gap-4",children:[o&&e.jsx("img",{src:o,className:"w-16 h-16",alt:"preview-thumb"}),e.jsxs("label",{htmlFor:"create-cate",className:"px-3 py-1 rounded-lg bg-primary text-white",children:["Tải ảnh",e.jsx("input",{type:"file",onChange:b,id:"create-cate",className:"sr-only"})]})]})]})]}),e.jsxs("div",{className:"mt-10 inline-flex items-center gap-4",children:[e.jsx("button",{type:"button",onClick:r,className:"inline-flex w-full justify-center rounded-md bg-[#DDDDDD] text-black px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-[#B6B6B6] hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Huỷ"}),e.jsx("button",{type:"submit",disabled:w,className:"inline-flex w-full justify-center rounded-md bg-primary text-white px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Tạo danh mục"})]})]})},te=({id:r,close:u,page:N,limit:i})=>{const h=B(),{register:H,setValue:x,trigger:g,handleSubmit:p,formState:{errors:y}}=I(),o=n=>{if(n.target.files){w(n.target.files[0]);const v=new FileReader;v.readAsDataURL(n.target.files[0]),v.onload=()=>t(v.result)}},{data:s,isLoading:b}=A({queryKey:["category",{id:r}],queryFn:()=>G(Number(r))}),[j,w]=D.useState(null),[k,t]=D.useState("");D.useEffect(()=>{s&&(x("name",s.name,{shouldDirty:!0}),x("thumbnail",s.thumbnail,{shouldDirty:!0}),t(s.thumbnail))},[s]);const{mutate:l,isLoading:c}=L(Y,{onSuccess:n=>{n.success?(d(m.success,"Cập nhật danh mục thành công!","success"),h.invalidateQueries({queryKey:["categories",{page:N,limit:i}]}),u()):d(m.error,n.message)}}),a=async n=>{const{name:v,thumbnail:F}=n,C=new FormData;C.append("name",v),C.append("thumbnail",j?null:F),C.append("newThumbnail",j),l({id:r,payload:C})};return b?e.jsx(q,{loadInside:!0}):e.jsxs("form",{onSubmit:async n=>{var F;if(n.preventDefault(),!await g())for(let C in y)return d(m.error,(F=y[C])==null?void 0:F.message);if(!k&&!j)return d(m.error,P);p(a)()},children:[e.jsxs("div",{className:"w-full flex flex-col justify-between bg-white dark:bg-form-strokedark p-4 gap-8 leading-normal",children:[e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Tên danh mục ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsx("input",{...H("name",{required:"Tên danh mục không được bỏ trống",value:s&&s.name}),type:"text",className:"w-full rounded-lg border-[1.5px] border-stroke bg-gray py-3 px-5 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"})]}),e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Hình ảnh ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsxs("div",{className:"w-full inline-flex items-center gap-4",children:[k&&e.jsx("img",{src:k,className:"w-16 h-16",alt:"preview-thumb"}),e.jsxs("label",{htmlFor:"create-cate",className:"px-3 py-1 rounded-lg bg-primary text-white",children:["Tải ảnh",e.jsx("input",{type:"file",onChange:o,id:"create-cate",className:"sr-only"})]})]})]})]}),e.jsxs("div",{className:"mt-10 inline-flex items-center gap-4",children:[e.jsx("button",{type:"button",onClick:()=>{t(""),w(null),u()},className:"inline-flex w-full justify-center rounded-md bg-[#DDDDDD] text-black px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-[#B6B6B6] hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Huỷ"}),e.jsx("button",{type:"submit",disabled:c,className:"inline-flex w-full justify-center rounded-md bg-primary text-white px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Cập nhật danh mục"})]})]})};export{le as default};
