import{i as M,g as w,k as E,u as T,a as D,b as $,c as q,m as I,R as O,j as e,L as Q,f as o,p as R,O as y,Q as f,n as j,E as N,d as X}from"./index-6bb4e948.js";import{P as G}from"./Pagination-ed89fb8d.js";import{M as K}from"./Modal-d0abd3ff.js";import{c as l,q as z,a as H,u as U}from"./base-7cc7a875.js";var F=(a=>(a.all="Tất cả",a.pending="Chờ xử lý",a.success="Đã xác nhận",a.canceled="Đã huỷ",a))(F||{});const J=async a=>{const{id:d,statusPayment:c}=a;return await M(`${l.endpoint}/payment/${d}`,JSON.stringify({statusPayment:c}),{Authorization:`Bearer ${w(l.cache.accessToken)}`})},V=async(a,d,c)=>{const r=z.stringify({page:a,limit:d,status:c},{skipNull:!0,skipEmptyString:!0}),i=await E(`${l.endpoint}/payments?${r}`,{Authorization:`Bearer ${w(l.cache.accessToken)}`});if(i.success)return i.data},ee=({title:a})=>{const{search:d}=T(),c=D(),r=$(t=>t.common),i=q(),v=I(),[C,S]=O.useState(0),s=new URLSearchParams(d),x=Number(s.get("page"))||l.pagination.PAGE,m=Number(s.get("limit"))||l.pagination.LIMIT,p=s.get("status"),{mutate:b,isLoading:g}=H(J,{onSuccess:t=>{t.success?(i(X()),v.invalidateQueries({queryKey:["transactions",{page:x,limit:m,status:p}]}),j(N.success,"Xác nhận giao dịch thành công!")):j(N.error,"Xảy ra lỗi! Không thể xác nhận giao dịch!")}}),{data:n,isLoading:L}=U({queryKey:["transactions",{page:x,limit:m,status:p}],queryFn:()=>V(x,m,p)}),k=n&&n.totalStatusPayment[s.get("status")??"all"],u=t=>{s.delete("page"),s.delete("limit"),t==="all"?s.delete("status"):s.set("status",t),c({search:s.toString()})},h=()=>i(f(!1)),B=()=>{var t;return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("p",{children:"Vui lòng xác nhận số tiền nhận được tại đây"}),e.jsxs("div",{className:"py-8 bg-gray text-2xl font-semibold rounded-lg",children:[y(n&&((t=n.payments)==null?void 0:t.filter(P=>P.id===r.modalId)[0].amount)),"đ"]})]})},A=()=>e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",disabled:g,className:"inline-flex w-full justify-center rounded-md bg-[#DDDDDD] text-black px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-[#B6B6B6] hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:()=>{h(),b({id:r.modalId,statusPayment:"canceled"})},children:"Huỷ giao dịch"}),e.jsx("button",{type:"button",className:"inline-flex w-full justify-center rounded-md bg-[#FBE69E] text-black px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-[#FFC700] hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:()=>{h(),c(`/chat?uid=${C}`)},children:"Nhắn tin"}),e.jsx("button",{type:"button",disabled:g,className:"inline-flex w-full justify-center rounded-md bg-primary text-white px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",onClick:()=>{h(),b({id:r.modalId,statusPayment:"success"})},children:"Xác nhận"})]});return L?e.jsx(Q,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-10 mb-4",children:[e.jsx("div",{className:"w-full inline-flex items-center justify-between",children:e.jsx("h4",{className:"text-xl font-semibold text-black dark:text-white",children:a})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("button",{onClick:()=>u("all"),type:"button",className:o("text-black bg-[#F3F3F3] hover:bg-[#FFC700]/90 focus:ring-2 focus:outline-none focus:ring-[#FFC700]/50 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:focus:ring-[#3b5998]/55",{"bg-[#FBE69E]":!s.get("status")}),children:e.jsxs("span",{className:"m-auto",children:["Tất cả (",n.totalStatusPayment.all,")"]})}),e.jsx("button",{onClick:()=>u("pending"),type:"button",className:o("text-black bg-[#F3F3F3] hover:bg-[#FFC700]/90 focus:ring-2 focus:outline-none focus:ring-[#FFC700]/50 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:focus:ring-[#3b5998]/55",{"bg-[#FBE69E]":s.get("status")==="pending"}),children:e.jsxs("span",{className:"m-auto",children:["Chờ xử lý (",n.totalStatusPayment.pending,")"]})}),e.jsx("button",{onClick:()=>u("success"),type:"button",className:o("text-black bg-[#F3F3F3] hover:bg-[#FFC700]/90 focus:ring-2 focus:outline-none focus:ring-[#FFC700]/50 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:focus:ring-[#3b5998]/55",{"bg-[#FBE69E]":s.get("status")==="success"}),children:e.jsxs("span",{className:"m-auto",children:["Đã xác nhận (",n.totalStatusPayment.success,")"]})}),e.jsx("button",{onClick:()=>u("canceled"),type:"button",className:o("text-black bg-[#F3F3F3] hover:bg-[#FFC700]/90 focus:ring-2 focus:outline-none focus:ring-[#FFC700]/50 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:focus:ring-[#3b5998]/55",{"bg-[#FBE69E]":s.get("status")==="canceled"}),children:e.jsxs("span",{className:"m-auto",children:["Đã huỷ (",n.totalStatusPayment.canceled,")"]})})]})]}),e.jsx("div",{className:"rounded-sm bg-white px-5 pt-6 pb-2.5 shadow-default dark:border-strokedark dark:bg-boxdark sm:px-7.5 xl:pb-1",children:e.jsx("div",{className:"max-w-full overflow-x-auto",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-2 text-left dark:bg-meta-4",children:[e.jsx("th",{className:"py-4 px-4 font-medium text-black dark:text-white",children:"ID"}),e.jsx("th",{className:"py-4 px-4 font-medium text-black dark:text-white",children:"Ngày"}),e.jsx("th",{className:"py-4 px-4 font-medium text-black dark:text-white",children:"Tên"}),e.jsx("th",{className:"py-4 px-4 font-medium text-black dark:text-white",children:"Số điện thoại"}),e.jsx("th",{className:"py-4 px-4 font-medium text-black dark:text-white",children:"Nội dung"}),e.jsx("th",{className:"py-4 px-4 font-medium text-black dark:text-white",children:"Số tiền"}),e.jsx("th",{className:"py-4 px-4 font-medium text-black dark:text-white",children:"Trạng thái"}),e.jsx("th",{className:"py-4 pl-4 font-medium text-black dark:text-white",children:"Hành động"})]})}),e.jsx("tbody",{children:n.payments.length>0&&n.payments.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"border-b border-[#eee] py-5 px-4 dark:border-strokedark",children:e.jsx(R,{to:`/transaction/${t.id}`,children:e.jsx("p",{className:"text-xs text-black dark:text-white",children:t.paymentCode})})}),e.jsx("td",{className:"border-b border-[#eee] py-5 px-4 dark:border-strokedark",children:e.jsx("p",{className:"text-xs font-semibold text-black dark:text-white text-ellipsis overflow-hidden",children:new Date(t.createAt).toLocaleDateString("en-GB")})}),e.jsx("td",{className:"border-b border-[#eee] py-5 px-4 dark:border-strokedark",children:e.jsx("p",{className:"text-xs text-black dark:text-white",children:t.user.name})}),e.jsx("td",{className:"border-b border-[#eee] py-5 px-4 dark:border-strokedark",children:e.jsx("p",{className:"text-xs text-black dark:text-white",children:t.user.phoneNumber})}),e.jsx("td",{className:"border-b border-[#eee] py-5 px-4 dark:border-strokedark",children:e.jsx("p",{className:"text-xs text-black dark:text-white",children:t.content})}),e.jsx("td",{className:"border-b border-[#eee] py-5 px-4 dark:border-strokedark",children:e.jsxs("p",{className:"text-xs text-center text-black dark:text-white",children:[y(t.amount),"đ"]})}),e.jsx("td",{className:"border-b border-[#eee] py-5 px-4 dark:border-strokedark",children:e.jsx("p",{className:o("text-xs text-center text-black dark:text-white",{"text-meta-1":t.status==="pending","text-success":t.status==="success","text-warning":t.status==="canceled"}),children:F[t.status]})}),t.status==="pending"&&e.jsx("td",{className:"border-b border-[#eee] py-5 pl-4 dark:border-strokedark",children:e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("button",{type:"button",onClick:()=>{S(t.userId),i(f({id:t.id,isOpen:!0}))},children:e.jsx("svg",{className:"fill-current",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2A10,10 0 0,1 22,12M20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,12M8.6,16.6L13.2,12L8.6,7.4L10,6L16,12L10,18L8.6,16.6Z"})})})})})]},t.id))})]})})}),k>0&&e.jsx("div",{className:"flex justify-center items-center my-4",children:e.jsx(G,{page:x,limit:m,total:k})}),r.isOpenModal&&e.jsx(K,{title:"Xác nhận giao dịch",body:e.jsx(B,{}),footer:e.jsx(A,{}),close:h})]})};export{ee as default};
