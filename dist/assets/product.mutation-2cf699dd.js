import{S as U,D as k,T as B,U as V,m as $,H as b,i as x,g as S,j as F,V as K,W as q}from"./index-f0192990.js";import{Q as G,b as W,d as J,e as X,f as Y,g as Z,h as ee,s as I,i as M,w as ne,j as te,c as m}from"./base-b320772a.js";import{p as n}from"./index-e9c7f7ea.js";class re extends U{constructor(t,r){super(),this.client=t,this.queries=[],this.result=[],this.observers=[],this.observersMap={},r&&this.setQueries(r)}onSubscribe(){this.listeners.size===1&&this.observers.forEach(t=>{t.subscribe(r=>{this.onUpdate(t,r)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,this.observers.forEach(t=>{t.destroy()})}setQueries(t,r){this.queries=t,k.batch(()=>{const e=this.observers,o=this.findMatchingObservers(this.queries);o.forEach(c=>c.observer.setOptions(c.defaultedQueryOptions,r));const s=o.map(c=>c.observer),u=Object.fromEntries(s.map(c=>[c.options.queryHash,c])),a=s.map(c=>c.getCurrentResult()),f=s.some((c,v)=>c!==e[v]);e.length===s.length&&!f||(this.observers=s,this.observersMap=u,this.result=a,this.hasListeners()&&(B(e,s).forEach(c=>{c.destroy()}),B(s,e).forEach(c=>{c.subscribe(v=>{this.onUpdate(c,v)})}),this.notify()))})}getCurrentResult(){return this.result}getQueries(){return this.observers.map(t=>t.getCurrentQuery())}getObservers(){return this.observers}getOptimisticResult(t){return this.findMatchingObservers(t).map(r=>r.observer.getOptimisticResult(r.defaultedQueryOptions))}findMatchingObservers(t){const r=this.observers,e=new Map(r.map(l=>[l.options.queryHash,l])),o=t.map(l=>this.client.defaultQueryOptions(l)),s=o.flatMap(l=>{const h=e.get(l.queryHash);return h!=null?[{defaultedQueryOptions:l,observer:h}]:[]}),u=new Set(s.map(l=>l.defaultedQueryOptions.queryHash)),a=o.filter(l=>!u.has(l.queryHash)),f=new Set(s.map(l=>l.observer)),c=r.filter(l=>!f.has(l)),v=l=>{const h=this.client.defaultQueryOptions(l),g=this.observersMap[h.queryHash];return g??new G(this.client,h)},d=a.map((l,h)=>{if(l.keepPreviousData){const g=c[h];if(g!==void 0)return{defaultedQueryOptions:l,observer:g}}return{defaultedQueryOptions:l,observer:v(l)}}),p=(l,h)=>o.indexOf(l.defaultedQueryOptions)-o.indexOf(h.defaultedQueryOptions);return s.concat(d).sort(p)}onUpdate(t,r){const e=this.observers.indexOf(t);e!==-1&&(this.result=V(this.result,e,r),this.notify())}notify(){k.batch(()=>{this.listeners.forEach(({listener:t})=>{t(this.result)})})}}function me({queries:i,context:t}){const r=$({context:t}),e=W(),o=J(),s=b.useMemo(()=>i.map(p=>{const l=r.defaultQueryOptions(p);return l._optimisticResults=e?"isRestoring":"optimistic",l}),[i,r,e]);s.forEach(p=>{X(p),Y(p,o)}),Z(o);const[u]=b.useState(()=>new re(r,s)),a=u.getOptimisticResult(s);ee(b.useCallback(p=>e?()=>{}:u.subscribe(k.batchCalls(p)),[u,e]),()=>u.getCurrentResult(),()=>u.getCurrentResult()),b.useEffect(()=>{u.setQueries(s,{listeners:!1})},[s,u]);const c=a.some((p,l)=>I(s[l],p,e))?a.flatMap((p,l)=>{const h=s[l],g=u.getObservers()[l];if(h&&g){if(I(h,p,e))return M(h,g,o);ne(p,e)&&M(h,g,o)}return[]}):[];if(c.length>0)throw Promise.all(c);const v=u.getQueries(),d=a.find((p,l)=>{var h,g;return te({result:p,errorResetBoundary:o,useErrorBoundary:(h=(g=s[l])==null?void 0:g.useErrorBoundary)!=null?h:!1,query:v[l]})});if(d!=null&&d.error)throw d.error;return a}const Ce=async()=>{const i=await x(`${m.endpoint}/categories`,{Authorization:`Bearer ${S(m.cache.accessToken)}`});if(i.success)return i.data.categories},Ee=async()=>{const i=await x(`${m.endpoint}/sizes`,{Authorization:`Bearer ${S(m.cache.accessToken)}`});if(i.success)return i.data.sizes};var T=globalThis&&globalThis.__assign||function(){return T=Object.assign||function(i){for(var t,r=1,e=arguments.length;r<e;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(i[o]=t[o])}return i},T.apply(this,arguments)},z={onActivate:n.func,onAddUndo:n.func,onBeforeAddUndo:n.func,onBeforeExecCommand:n.func,onBeforeGetContent:n.func,onBeforeRenderUI:n.func,onBeforeSetContent:n.func,onBeforePaste:n.func,onBlur:n.func,onChange:n.func,onClearUndos:n.func,onClick:n.func,onContextMenu:n.func,onCommentChange:n.func,onCopy:n.func,onCut:n.func,onDblclick:n.func,onDeactivate:n.func,onDirty:n.func,onDrag:n.func,onDragDrop:n.func,onDragEnd:n.func,onDragGesture:n.func,onDragOver:n.func,onDrop:n.func,onExecCommand:n.func,onFocus:n.func,onFocusIn:n.func,onFocusOut:n.func,onGetContent:n.func,onHide:n.func,onInit:n.func,onKeyDown:n.func,onKeyPress:n.func,onKeyUp:n.func,onLoadContent:n.func,onMouseDown:n.func,onMouseEnter:n.func,onMouseLeave:n.func,onMouseMove:n.func,onMouseOut:n.func,onMouseOver:n.func,onMouseUp:n.func,onNodeChange:n.func,onObjectResizeStart:n.func,onObjectResized:n.func,onObjectSelected:n.func,onPaste:n.func,onPostProcess:n.func,onPostRender:n.func,onPreProcess:n.func,onProgressState:n.func,onRedo:n.func,onRemove:n.func,onReset:n.func,onSaveContent:n.func,onSelectionChange:n.func,onSetAttrib:n.func,onSetContent:n.func,onShow:n.func,onSubmit:n.func,onUndo:n.func,onVisualAid:n.func,onSkinLoadError:n.func,onThemeLoadError:n.func,onModelLoadError:n.func,onPluginLoadError:n.func,onIconsLoadError:n.func,onLanguageLoadError:n.func,onScriptsLoad:n.func,onScriptsLoadError:n.func},ie=T({apiKey:n.string,id:n.string,inline:n.bool,init:n.object,initialValue:n.string,onEditorChange:n.func,value:n.string,tagName:n.string,cloudChannel:n.string,plugins:n.oneOfType([n.string,n.array]),toolbar:n.oneOfType([n.string,n.array]),disabled:n.bool,textareaName:n.string,tinymceScriptSrc:n.oneOfType([n.string,n.arrayOf(n.string),n.arrayOf(n.shape({src:n.string,async:n.bool,defer:n.bool}))]),rollback:n.oneOfType([n.number,n.oneOf([!1])]),scriptLoading:n.shape({async:n.bool,defer:n.bool,delay:n.number})},z),w=function(i){return typeof i=="function"},D=function(i){return i in z},j=function(i){return i.substr(2)},oe=function(i,t,r,e,o,s,u){var a=Object.keys(o).filter(D),f=Object.keys(s).filter(D),c=a.filter(function(d){return s[d]===void 0}),v=f.filter(function(d){return o[d]===void 0});c.forEach(function(d){var p=j(d),l=u[p];r(p,l),delete u[p]}),v.forEach(function(d){var p=e(i,d),l=j(d);u[l]=p,t(l,p)})},se=function(i,t,r,e,o){return oe(o,i.on.bind(i),i.off.bind(i),function(s,u){return function(a){var f;return(f=s(u))===null||f===void 0?void 0:f(a,i)}},t,r,e)},Q=0,N=function(i){var t=Date.now(),r=Math.floor(Math.random()*1e9);return Q++,i+"_"+r+Q+String(t)},P=function(i){return i!==null&&(i.tagName.toLowerCase()==="textarea"||i.tagName.toLowerCase()==="input")},A=function(i){return typeof i>"u"||i===""?[]:Array.isArray(i)?i:i.split(" ")},ae=function(i,t){return A(i).concat(A(t))},ue=function(){return window.InputEvent&&typeof InputEvent.prototype.getTargetRanges=="function"},ce=function(i){if(!("isConnected"in Node.prototype)){for(var t=i,r=i.parentNode;r!=null;)t=r,r=t.parentNode;return t===i.ownerDocument}return i.isConnected},H=function(i,t){i!==void 0&&(i.mode!=null&&typeof i.mode=="object"&&typeof i.mode.set=="function"?i.mode.set(t):i.setMode(t))},L=globalThis&&globalThis.__assign||function(){return L=Object.assign||function(i){for(var t,r=1,e=arguments.length;r<e;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(i[o]=t[o])}return i},L.apply(this,arguments)},le=function(i,t,r){var e,o,s=i.createElement("script");s.referrerPolicy="origin",s.type="application/javascript",s.id=t.id,s.src=t.src,s.async=(e=t.async)!==null&&e!==void 0?e:!1,s.defer=(o=t.defer)!==null&&o!==void 0?o:!1;var u=function(){s.removeEventListener("load",u),s.removeEventListener("error",a),r(t.src)},a=function(f){s.removeEventListener("load",u),s.removeEventListener("error",a),r(t.src,f)};s.addEventListener("load",u),s.addEventListener("error",a),i.head&&i.head.appendChild(s)},fe=function(i){var t={},r=function(u,a){var f=t[u];f.done=!0,f.error=a;for(var c=0,v=f.handlers;c<v.length;c++){var d=v[c];d(u,a)}f.handlers=[]},e=function(u,a,f){var c=function(E){return f!==void 0?f(E):console.error(E)};if(u.length===0){c(new Error("At least one script must be provided"));return}for(var v=0,d=!1,p=function(E,R){d||(R?(d=!0,c(R)):++v===u.length&&a())},l=0,h=u;l<h.length;l++){var g=h[l],y=t[g.src];if(y)y.done?p(g.src,y.error):y.handlers.push(p);else{var C=N("tiny-");t[g.src]={id:C,src:g.src,done:!1,error:null,handlers:[p]},le(i,L({id:C},g),r)}}},o=function(){for(var u,a=0,f=Object.values(t);a<f.length;a++){var c=f[a],v=i.getElementById(c.id);v!=null&&v.tagName==="SCRIPT"&&((u=v.parentNode)===null||u===void 0||u.removeChild(v))}t={}},s=function(){return i};return{loadScripts:e,deleteScripts:o,getDocument:s}},de=function(){var i=[],t=function(o){var s=i.find(function(u){return u.getDocument()===o});return s===void 0&&(s=fe(o),i.push(s)),s},r=function(o,s,u,a,f){var c=function(){return t(o).loadScripts(s,a,f)};u>0?setTimeout(c,u):c()},e=function(){for(var o=i.pop();o!=null;o=i.pop())o.deleteScripts()};return{loadList:r,reinitialize:e}},pe=de(),_=function(i){var t=i;return t&&t.tinymce?t.tinymce:null},he=globalThis&&globalThis.__extends||function(){var i=function(t,r){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s])},i(t,r)};return function(t,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");i(t,r);function e(){this.constructor=t}t.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)}}(),O=globalThis&&globalThis.__assign||function(){return O=Object.assign||function(i){for(var t,r=1,e=arguments.length;r<e;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(i[o]=t[o])}return i},O.apply(this,arguments)},ve=function(i){he(t,i);function t(r){var e=this,o,s,u;return e=i.call(this,r)||this,e.rollbackTimer=void 0,e.valueCursor=void 0,e.rollbackChange=function(){var a=e.editor,f=e.props.value;a&&f&&f!==e.currentContent&&a.undoManager.ignore(function(){if(a.setContent(f),e.valueCursor&&(!e.inline||a.hasFocus()))try{a.selection.moveToBookmark(e.valueCursor)}catch{}}),e.rollbackTimer=void 0},e.handleBeforeInput=function(a){if(e.props.value!==void 0&&e.props.value===e.currentContent&&e.editor&&(!e.inline||e.editor.hasFocus()))try{e.valueCursor=e.editor.selection.getBookmark(3)}catch{}},e.handleBeforeInputSpecial=function(a){(a.key==="Enter"||a.key==="Backspace"||a.key==="Delete")&&e.handleBeforeInput(a)},e.handleEditorChange=function(a){var f=e.editor;if(f&&f.initialized){var c=f.getContent();e.props.value!==void 0&&e.props.value!==c&&e.props.rollback!==!1&&(e.rollbackTimer||(e.rollbackTimer=window.setTimeout(e.rollbackChange,typeof e.props.rollback=="number"?e.props.rollback:200))),c!==e.currentContent&&(e.currentContent=c,w(e.props.onEditorChange)&&e.props.onEditorChange(c,f))}},e.handleEditorChangeSpecial=function(a){(a.key==="Backspace"||a.key==="Delete")&&e.handleEditorChange(a)},e.initialise=function(a){var f,c,v;a===void 0&&(a=0);var d=e.elementRef.current;if(d){if(!ce(d)){if(a===0)setTimeout(function(){return e.initialise(1)},1);else if(a<100)setTimeout(function(){return e.initialise(a+1)},100);else throw new Error("tinymce can only be initialised when in a document");return}var p=_(e.view);if(!p)throw new Error("tinymce should have been loaded into global scope");var l=O(O({},e.props.init),{selector:void 0,target:d,readonly:e.props.disabled,inline:e.inline,plugins:ae((f=e.props.init)===null||f===void 0?void 0:f.plugins,e.props.plugins),toolbar:(c=e.props.toolbar)!==null&&c!==void 0?c:(v=e.props.init)===null||v===void 0?void 0:v.toolbar,setup:function(h){e.editor=h,e.bindHandlers({}),e.inline&&!P(d)&&h.once("PostRender",function(g){h.setContent(e.getInitialValue(),{no_events:!0})}),e.props.init&&w(e.props.init.setup)&&e.props.init.setup(h)},init_instance_callback:function(h){var g,y,C=e.getInitialValue();e.currentContent=(g=e.currentContent)!==null&&g!==void 0?g:h.getContent(),e.currentContent!==C&&(e.currentContent=C,h.setContent(C),h.undoManager.clear(),h.undoManager.add(),h.setDirty(!1));var E=(y=e.props.disabled)!==null&&y!==void 0?y:!1;H(e.editor,E?"readonly":"design"),e.props.init&&w(e.props.init.init_instance_callback)&&e.props.init.init_instance_callback(h)}});e.inline||(d.style.visibility=""),P(d)&&(d.value=e.getInitialValue()),p.init(l)}},e.id=e.props.id||N("tiny-react"),e.elementRef=b.createRef(),e.inline=(u=(o=e.props.inline)!==null&&o!==void 0?o:(s=e.props.init)===null||s===void 0?void 0:s.inline)!==null&&u!==void 0?u:!1,e.boundHandlers={},e}return Object.defineProperty(t.prototype,"view",{get:function(){var r,e;return(e=(r=this.elementRef.current)===null||r===void 0?void 0:r.ownerDocument.defaultView)!==null&&e!==void 0?e:window},enumerable:!1,configurable:!0}),t.prototype.componentDidUpdate=function(r){var e=this,o,s;if(this.rollbackTimer&&(clearTimeout(this.rollbackTimer),this.rollbackTimer=void 0),this.editor&&(this.bindHandlers(r),this.editor.initialized)){if(this.currentContent=(o=this.currentContent)!==null&&o!==void 0?o:this.editor.getContent(),typeof this.props.initialValue=="string"&&this.props.initialValue!==r.initialValue)this.editor.setContent(this.props.initialValue),this.editor.undoManager.clear(),this.editor.undoManager.add(),this.editor.setDirty(!1);else if(typeof this.props.value=="string"&&this.props.value!==this.currentContent){var u=this.editor;u.undoManager.transact(function(){var f;if(!e.inline||u.hasFocus())try{f=u.selection.getBookmark(3)}catch{}var c=e.valueCursor;if(u.setContent(e.props.value),!e.inline||u.hasFocus())for(var v=0,d=[f,c];v<d.length;v++){var p=d[v];if(p)try{u.selection.moveToBookmark(p),e.valueCursor=p;break}catch{}}})}if(this.props.disabled!==r.disabled){var a=(s=this.props.disabled)!==null&&s!==void 0?s:!1;H(this.editor,a?"readonly":"design")}}},t.prototype.componentDidMount=function(){var r=this,e,o,s,u,a;if(_(this.view)!==null)this.initialise();else if(Array.isArray(this.props.tinymceScriptSrc)&&this.props.tinymceScriptSrc.length===0)(o=(e=this.props).onScriptsLoadError)===null||o===void 0||o.call(e,new Error("No `tinymce` global is present but the `tinymceScriptSrc` prop was an empty array."));else if(!((s=this.elementRef.current)===null||s===void 0)&&s.ownerDocument){var f=function(){var v,d;(d=(v=r.props).onScriptsLoad)===null||d===void 0||d.call(v),r.initialise()},c=function(v){var d,p;(p=(d=r.props).onScriptsLoadError)===null||p===void 0||p.call(d,v)};pe.loadList(this.elementRef.current.ownerDocument,this.getScriptSources(),(a=(u=this.props.scriptLoading)===null||u===void 0?void 0:u.delay)!==null&&a!==void 0?a:0,f,c)}},t.prototype.componentWillUnmount=function(){var r=this,e=this.editor;e&&(e.off(this.changeEvents(),this.handleEditorChange),e.off(this.beforeInputEvent(),this.handleBeforeInput),e.off("keypress",this.handleEditorChangeSpecial),e.off("keydown",this.handleBeforeInputSpecial),e.off("NewBlock",this.handleEditorChange),Object.keys(this.boundHandlers).forEach(function(o){e.off(o,r.boundHandlers[o])}),this.boundHandlers={},e.remove(),this.editor=void 0)},t.prototype.render=function(){return this.inline?this.renderInline():this.renderIframe()},t.prototype.changeEvents=function(){var r,e,o,s=(o=(e=(r=_(this.view))===null||r===void 0?void 0:r.Env)===null||e===void 0?void 0:e.browser)===null||o===void 0?void 0:o.isIE();return s?"change keyup compositionend setcontent CommentChange":"change input compositionend setcontent CommentChange"},t.prototype.beforeInputEvent=function(){return ue()?"beforeinput SelectionChange":"SelectionChange"},t.prototype.renderInline=function(){var r=this.props.tagName,e=r===void 0?"div":r;return b.createElement(e,{ref:this.elementRef,id:this.id})},t.prototype.renderIframe=function(){return b.createElement("textarea",{ref:this.elementRef,style:{visibility:"hidden"},name:this.props.textareaName,id:this.id})},t.prototype.getScriptSources=function(){var r,e,o=(r=this.props.scriptLoading)===null||r===void 0?void 0:r.async,s=(e=this.props.scriptLoading)===null||e===void 0?void 0:e.defer;if(this.props.tinymceScriptSrc!==void 0)return typeof this.props.tinymceScriptSrc=="string"?[{src:this.props.tinymceScriptSrc,async:o,defer:s}]:this.props.tinymceScriptSrc.map(function(c){return typeof c=="string"?{src:c,async:o,defer:s}:c});var u=this.props.cloudChannel,a=this.props.apiKey?this.props.apiKey:"no-api-key",f="https://cdn.tiny.cloud/1/".concat(a,"/tinymce/").concat(u,"/tinymce.min.js");return[{src:f,async:o,defer:s}]},t.prototype.getInitialValue=function(){return typeof this.props.initialValue=="string"?this.props.initialValue:typeof this.props.value=="string"?this.props.value:""},t.prototype.bindHandlers=function(r){var e=this;if(this.editor!==void 0){se(this.editor,r,this.props,this.boundHandlers,function(a){return e.props[a]});var o=function(a){return a.onEditorChange!==void 0||a.value!==void 0},s=o(r),u=o(this.props);!s&&u?(this.editor.on(this.changeEvents(),this.handleEditorChange),this.editor.on(this.beforeInputEvent(),this.handleBeforeInput),this.editor.on("keydown",this.handleBeforeInputSpecial),this.editor.on("keyup",this.handleEditorChangeSpecial),this.editor.on("NewBlock",this.handleEditorChange)):s&&!u&&(this.editor.off(this.changeEvents(),this.handleEditorChange),this.editor.off(this.beforeInputEvent(),this.handleBeforeInput),this.editor.off("keydown",this.handleBeforeInputSpecial),this.editor.off("keyup",this.handleEditorChangeSpecial),this.editor.off("NewBlock",this.handleEditorChange))}},t.propTypes=ie,t.defaultProps={cloudChannel:"6"},t}(b.Component);const Oe=({initContent:i,getContent:t})=>F.jsx(ve,{apiKey:"df4xfwysyt7xdzreywi9m58z5jpaj5ke6cwff4zgobsp54ru",init:{placeholder:"Nhập mô tả sản phẩm",height:600,plugins:"anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount",toolbar:"undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table | align lineheight | numlist bullist indent outdent | emoticons charmap | removeformat",images_file_types:"jpg,jpeg,png,webp",file_picker_types:"image",file_picker_callback:(r,e,o)=>{const s=document.createElement("input");s.setAttribute("type","file"),s.setAttribute("accept","image/*"),s.addEventListener("change",u=>{var c;const a=(c=u.target)==null?void 0:c.files[0],f=new FileReader;f.addEventListener("load",()=>{var h;const v="blobid"+new Date().getTime(),d=tinymce.activeEditor.editorUpload.blobCache,p=(h=f.result)==null?void 0:h.split(",")[1],l=d.create(v,a,p);d.add(l),r(l.blobUri(),{title:a.name})}),f.readAsDataURL(a)}),s.click()}},initialValue:i??"",onEditorChange:(r,e)=>t(r)}),Se=async i=>await K(`${m.endpoint}/product`,i,{Authorization:`Bearer ${S(m.cache.accessToken)}`}),we=async i=>await q(`${m.endpoint}/product/${i.id}`,i.payload,{Authorization:`Bearer ${S(m.cache.accessToken)}`});export{Oe as T,Ee as a,we as b,Se as c,Ce as g,me as u};
