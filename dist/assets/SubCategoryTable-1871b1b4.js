import{i as T,g as L,O as A,u as E,a as R,b as $,c as K,R as C,j as e,L as O,ai as F,m as M,n as p,E as g,e as Q}from"./index-47085293.js";import{P as U}from"./Pagination-b080a820.js";import{q as Z,c as H,a as q,u as z}from"./base-e6441cfb.js";import{a as G}from"./category.query-3ad7af6d.js";import{u as J,F as S,a as B}from"./index.esm-e6989ff6.js";import{M as D}from"./Modal-adf6992b.js";import{u as W}from"./useQueries-3b8759a8.js";const X=async(n,i,d)=>{const m=Z.stringify({page:n,limit:i},{skipNull:!0,skipEmptyString:!0}),a=await T(`${H.endpoint}/sub-category/category/${d}?${m}`,{Authorization:`Bearer ${L(H.cache.accessToken)}`});if(a.success)return a.data},Y=async n=>{const i=await T(`${H.endpoint}/sub-category/${n}`,{Authorization:`Bearer ${L(H.cache.accessToken)}`});if(i.success)return i.data.subCategory},I="Ảnh danh mục phụ không được bỏ trống!",oe=({title:n})=>{const{id:i}=A(),{search:d}=E(),m=R(),a=$(t=>t.common),f=K(),b=J(),[y,j]=C.useState(""),w=new URLSearchParams(d),u=Number(w.get("page"))||H.pagination.PAGE,s=Number(w.get("limit"))||H.pagination.LIMIT,[o,r]=W({queries:[{queryKey:["category"],queryFn:()=>G(Number(i))},{queryKey:["subCategories",{page:u,limit:s}],queryFn:()=>X(u,s,Number(i))}]});console.log(r.data);const N=r.data&&r.data.totalSubCategory,c=()=>{b.reset(),f(Q())};return o.isError&&m(-1),r.isLoading?e.jsx(O,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-10 mb-6",children:e.jsxs("div",{className:"w-full inline-flex items-center justify-between",children:[e.jsxs("h4",{className:"text-xl font-semibold text-black dark:text-white",children:[n," ",">"," ",o.data.name]}),e.jsx("div",{className:"inline-flex items-center gap-4",children:e.jsxs("button",{type:"button",className:"text-black bg-[#FBE69E] hover:bg-[#FFC700]/90 focus:ring-2 focus:outline-none focus:ring-[#FFC700]/50 font-medium rounded-lg text-xs px-5 py-2.5 text-center inline-flex items-center dark:focus:ring-[#3b5998]/55",onClick:()=>{j("create"),f(F({id:0,isOpen:!0}))},children:["Tạo danh mục phụ",e.jsx("svg",{className:"w-4 h-4 ml-4","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"})})]})})]})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"grid grid-cols-4 border-stroke py-4 dark:border-strokedark sm:grid-cols-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("h5",{className:"text-sm font-bold xsm:text-base",children:"HÌnh ảnh"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h5",{className:"text-sm font-bold xl:text-base",children:"Danh mục phụ"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h5",{className:"text-sm text-center font-bold xl:text-base",children:"Số lượng sản phẩm"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h5",{className:"text-sm text-center font-bold xsm:text-base",children:"Hành động"})})]}),r.data.subCategories.length>0&&r.data.subCategories.map(t=>e.jsxs("div",{className:"grid grid-cols-4 border-t border-stroke py-4 dark:border-strokedark sm:grid-cols-4",children:[e.jsx("img",{className:"col-span-1 w-14 rounded-md",src:t.thumbnail,alt:"subCategory"}),e.jsx("div",{className:"flex flex-col gap-2 justify-center",children:e.jsx("p",{className:"text-xs font-semibold text-black dark:text-white text-ellipsis overflow-hidden",children:t.name})}),e.jsx("div",{className:"col-span-1 flex justify-center items-center",children:e.jsx("p",{className:"text-xs text-center text-black dark:text-white",children:t.totalProduct})}),e.jsxs("div",{className:"col-span-1 inline-flex items-center justify-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{j("update"),f(F({id:t.id,isOpen:!0}))},className:"hover:text-primary",children:e.jsx("svg",{className:"fill-current",width:24,height:24,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M5,3C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19H5V5H12V3H5M17.78,4C17.61,4 17.43,4.07 17.3,4.2L16.08,5.41L18.58,7.91L19.8,6.7C20.06,6.44 20.06,6 19.8,5.75L18.25,4.2C18.12,4.07 17.95,4 17.78,4M15.37,6.12L8,13.5V16H10.5L17.87,8.62L15.37,6.12Z"})})}),e.jsx("button",{type:"button",className:"hover:text-primary",children:e.jsx("svg",{className:"fill-current",width:24,height:24,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"})})})]})]},t.id)),N>0&&e.jsx("div",{className:"flex justify-center items-center my-4",children:e.jsx(U,{page:u,limit:s,total:N})}),a.isOpenModal&&y==="create"&&a.modalId===0&&e.jsx(S,{...b,children:e.jsx(D,{title:"Tạo danh mục phụ",body:e.jsx(_,{cateId:o.data.id,cateName:o.data.name,close:c}),isForm:!0})}),a.isOpenModal&&y==="update"&&a.modalId>0&&e.jsx(S,{...b,children:e.jsx(D,{title:"Cập nhật danh mục phụ",body:e.jsx(ee,{id:a.modalId,cateId:o.data.id,cateName:o.data.name,close:c}),isForm:!0})})]})]})},_=({cateId:n,cateName:i,close:d})=>{const m=M(),{register:a,trigger:f,handleSubmit:b,formState:{errors:y}}=B(),[j,w]=C.useState(null),[u,s]=C.useState(""),o=t=>{if(t.target.files){w(t.target.files[0]);const x=new FileReader;x.onload=()=>s(x.result),x.readAsDataURL(t.target.files[0])}},{mutate:r,isLoading:N}=q(null,{onSuccess:t=>{t.success?(p(g.success,"Tạo mới danh mục phụ thành công!","success","top-center"),m.invalidateQueries({queryKey:["subCategories"]}),d()):p(g.error,t.message)}}),c=async t=>{const{name:x}=t,h=new FormData;h.append("name",x),h.append("thumbnail",j),r(h)};return e.jsxs("form",{onSubmit:async t=>{var h;if(t.preventDefault(),!await f())for(let V in y)return p(g.error,(h=y[V])==null?void 0:h.message);if(!j)return p(g.error,I);b(c)()},children:[e.jsxs("div",{className:"w-full flex flex-col justify-between bg-white dark:bg-form-strokedark p-4 gap-8 leading-normal",children:[e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsx("p",{className:"w-1/4 text-sm text-left",children:"Tên danh mục chính"}),e.jsx("input",{type:"text",defaultValue:i,disabled:!0,className:"w-full rounded-lg border-[1.5px] border-stroke bg-gray py-3 px-5 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"})]}),e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Tên danh mục phụ ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsx("input",{...a("name",{required:"Tên danh mục phụ không được bỏ trống"}),type:"text",className:"w-full rounded-lg border-[1.5px] border-stroke bg-gray py-3 px-5 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"})]}),e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Hình ảnh ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsxs("div",{className:"w-full inline-flex items-center gap-4",children:[u&&e.jsx("img",{src:u,className:"w-16 h-16",alt:"preview-thumb"}),e.jsxs("label",{htmlFor:"create-cate",className:"px-3 py-1 rounded-lg bg-primary text-white",children:["Tải ảnh",e.jsx("input",{type:"file",onChange:o,id:"create-cate",className:"sr-only"})]})]})]})]}),e.jsxs("div",{className:"mt-10 inline-flex items-center gap-4",children:[e.jsx("button",{type:"button",onClick:d,className:"inline-flex w-full justify-center rounded-md bg-[#DDDDDD] text-black px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-[#B6B6B6] hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Huỷ"}),e.jsx("button",{type:"submit",disabled:N,className:"inline-flex w-full justify-center rounded-md bg-primary text-white px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Tạo danh mục"})]})]})},ee=({id:n,cateId:i,cateName:d,close:m})=>{const a=M(),{register:f,setValue:b,trigger:y,handleSubmit:j,formState:{errors:w}}=B(),u=l=>{if(l.target.files){N(l.target.files[0]);const v=new FileReader;v.onload=()=>t(v.result),v.readAsDataURL(l.target.files[0])}},{data:s,isLoading:o}=z({queryKey:["subcategory",{id:n}],queryFn:()=>Y(Number(n))}),[r,N]=C.useState(null),[c,t]=C.useState("");C.useEffect(()=>{s&&(b("name",s.name,{shouldDirty:!0}),t(s.thumbnail))},[s]),console.log(s);const{mutate:x,isLoading:h}=q(null,{onSuccess:l=>{l.success?(p(g.success,"Cập nhật danh mục phụ thành công!","success","top-center"),a.invalidateQueries({queryKey:["subCategories"]}),m()):p(g.error,l.message)}}),V=async l=>{const{name:v}=l,k=new FormData;k.append("name",v),k.append("thumbnail",c),k.append("newThumbnail",r),x({id:n,payload:k})};return e.jsxs("form",{onSubmit:async l=>{var k;if(l.preventDefault(),!await y())for(let P in w)return p(g.error,(k=w[P])==null?void 0:k.message);if(!c&&!r)return p(g.error,I);j(V)()},children:[e.jsxs("div",{className:"w-full flex flex-col justify-between bg-white dark:bg-form-strokedark p-4 gap-8 leading-normal",children:[e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsx("p",{className:"w-1/4 text-sm text-left",children:"Tên danh mục chính"}),e.jsx("input",{type:"text",defaultValue:d,disabled:!0,className:"w-full rounded-lg border-[1.5px] border-stroke bg-gray py-3 px-5 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"})]}),e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Tên danh mục ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsx("input",{...f("name",{required:"Tên danh mục không được bỏ trống",value:s&&s.name}),type:"text",className:"w-full rounded-lg border-[1.5px] border-stroke bg-gray py-3 px-5 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"})]}),e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Hình ảnh ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsxs("div",{className:"w-full inline-flex items-center gap-4",children:[c&&e.jsx("img",{src:c,className:"w-16 h-16",alt:"preview-thumb"}),e.jsxs("label",{htmlFor:"create-cate",className:"px-3 py-1 rounded-lg bg-primary text-white",children:["Tải ảnh",e.jsx("input",{type:"file",onChange:u,id:"create-cate",className:"sr-only"})]})]})]})]}),e.jsxs("div",{className:"mt-10 inline-flex items-center gap-4",children:[e.jsx("button",{type:"button",onClick:()=>{t(""),N(null),m()},className:"inline-flex w-full justify-center rounded-md bg-[#DDDDDD] text-black px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-[#B6B6B6] hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Huỷ"}),e.jsx("button",{type:"submit",disabled:h,className:"inline-flex w-full justify-center rounded-md bg-primary text-white px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Cập nhật danh mục"})]})]})};export{oe as default};
