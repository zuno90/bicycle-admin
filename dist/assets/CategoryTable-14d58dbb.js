import{Z as P,g as L,$ as I,u as E,a as R,b as $,c as O,R as v,j as e,L as M,P as D,k as T,n as h,E as g,e as U}from"./index-28192e3f.js";import{P as K}from"./Pagination-069b2076.js";import{g as Q,a as Z}from"./category.query-e5221d87.js";import{c as k,u as S,a as B}from"./base-a6ef644b.js";import{M as F}from"./Modal-214bacdf.js";import{u as z,F as V,a as q}from"./index.esm-62b15f1a.js";const G=async a=>await P(`${k.endpoint}/category`,a,{Authorization:`Bearer ${L(k.cache.accessToken)}`}),J=async a=>await I(`${k.endpoint}/category/${a.id}`,a.payload,{Authorization:`Bearer ${L(k.cache.accessToken)}`}),A="Ảnh danh mục không được bỏ trống!",re=({title:a})=>{const{search:d}=E(),y=R(),o=$(s=>s.common),c=O(),m=z(),[p,u]=v.useState(""),f=new URLSearchParams(d),r=Number(f.get("page"))||k.pagination.PAGE,b=Number(f.get("limit"))||k.pagination.LIMIT,{data:l,isLoading:j}=S({queryKey:["categories",{page:r,limit:b}],queryFn:()=>Q(r,b)}),x=l&&l.totalCategory,t=()=>{m.reset(),c(U())};return j?e.jsx(M,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-10 mb-6",children:e.jsxs("div",{className:"w-full inline-flex items-center justify-between",children:[e.jsx("h4",{className:"text-xl font-semibold text-black dark:text-white",children:a}),e.jsx("div",{className:"inline-flex items-center gap-4",children:e.jsxs("button",{type:"button",className:"text-black bg-[#FBE69E] hover:bg-[#FFC700]/90 focus:ring-2 focus:outline-none focus:ring-[#FFC700]/50 font-medium rounded-lg text-xs px-5 py-2.5 text-center inline-flex items-center dark:focus:ring-[#3b5998]/55",onClick:()=>{u("create"),c(D({id:0,isOpen:!0}))},children:["Tạo danh mục chính",e.jsx("svg",{className:"w-4 h-4 ml-4","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"})})]})})]})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"grid grid-cols-7 border-stroke py-4 dark:border-strokedark sm:grid-cols-7",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("h5",{className:"text-sm font-bold xsm:text-base",children:"Hình ảnh"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h5",{className:"text-sm font-bold xsm:text-base",children:"Danh mục chính"})}),e.jsx("div",{className:"col-span-4",children:e.jsx("h5",{className:"text-sm font-bold xsm:text-base",children:"Danh mục phụ"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h5",{className:"text-sm font-bold text-center xsm:text-base",children:"Hành động"})})]}),l.categories.length>0&&l.categories.map(s=>e.jsxs("div",{className:"grid grid-cols-7 border-t border-stroke py-4 dark:border-strokedark sm:grid-cols-7",children:[e.jsx("div",{className:"col-span-1 flex items-center gap-2",children:e.jsx("img",{className:"w-14 rounded-lg cursor-pointer",src:s.thumbnail,alt:"category",onClick:()=>y(`/category/${s.id}`)})}),e.jsx("div",{className:"col-span-1 flex flex-col gap-2 justify-center",children:e.jsx("p",{onClick:()=>y(`/category/${s.id}`),className:"text-xs font-semibold text-black dark:text-white text-ellipsis overflow-hidden cursor-pointer",children:s.name})}),e.jsx("div",{className:"col-span-4 flex items-center",children:e.jsx("div",{className:"text-xs text-left text-black dark:text-white inline-flex items-center space-x-2",children:s.subCategories.map(n=>e.jsx("button",{type:"button",className:"bg-[#D7D7D7] px-2.5 py-1.5 rounded-full",children:n.name},n.id))})}),e.jsxs("div",{className:"col-span-1 inline-flex items-center justify-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{u("update"),c(D({id:s.id,isOpen:!0}))},className:"hover:text-primary",children:e.jsx("svg",{className:"fill-current",width:24,height:24,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M5,3C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19H5V5H12V3H5M17.78,4C17.61,4 17.43,4.07 17.3,4.2L16.08,5.41L18.58,7.91L19.8,6.7C20.06,6.44 20.06,6 19.8,5.75L18.25,4.2C18.12,4.07 17.95,4 17.78,4M15.37,6.12L8,13.5V16H10.5L17.87,8.62L15.37,6.12Z"})})}),e.jsx("button",{type:"button",onClick:()=>{u("remove"),c(D({id:s.id,isOpen:!0}))},className:"hover:text-primary",children:e.jsx("svg",{className:"fill-current",width:24,height:24,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"})})})]})]},s.id)),x>0&&e.jsx("div",{className:"flex justify-center items-center my-4",children:e.jsx(K,{page:r,limit:b,total:x})}),o.isOpenModal&&p==="create"&&o.modalId===0&&e.jsx(V,{...m,children:e.jsx(F,{title:"Tạo danh mục chính",body:e.jsx(W,{close:t}),isForm:!0})}),o.isOpenModal&&p==="update"&&o.modalId>0&&e.jsx(V,{...m,children:e.jsx(F,{title:"Cập nhật danh mục",body:e.jsx(X,{id:o.modalId,close:t}),isForm:!0})})]})]})},W=({close:a})=>{const d=T(),{register:y,trigger:o,handleSubmit:c,formState:{errors:m}}=q(),[p,u]=v.useState(),[f,r]=v.useState(""),b=t=>{if(t.target.files){u(t.target.files[0]);const s=new FileReader;s.onload=()=>r(s.result),s.readAsDataURL(t.target.files[0])}},{mutate:l,isLoading:j}=B(G,{onSuccess:t=>{t.success?(h(g.success,"Tạo mới danh mục thành công!","success"),d.invalidateQueries({queryKey:["categories"]}),a()):h(g.error,t.message)}}),x=async t=>{const{name:s}=t,n=new FormData;n.append("name",s),n.append("thumbnail",p),l(n)};return e.jsxs("form",{onSubmit:async t=>{var n;if(t.preventDefault(),!await o())for(let H in m)return h(g.error,(n=m[H])==null?void 0:n.message);if(!p)return h(g.error,A);c(x)()},children:[e.jsxs("div",{className:"w-full flex flex-col justify-between bg-white dark:bg-form-strokedark p-4 gap-8 leading-normal",children:[e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Tên danh mục ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsx("input",{...y("name",{required:"Tên danh mục không được bỏ trống"}),type:"text",className:"w-full rounded-lg border-[1.5px] border-stroke bg-gray py-3 px-5 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"})]}),e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Hình ảnh ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsxs("div",{className:"w-full inline-flex items-center gap-4",children:[f&&e.jsx("img",{src:f,className:"w-16 h-16",alt:"preview-thumb"}),e.jsxs("label",{htmlFor:"create-cate",className:"px-3 py-1 rounded-lg bg-primary text-white",children:["Tải ảnh",e.jsx("input",{type:"file",onChange:b,id:"create-cate",className:"sr-only"})]})]})]})]}),e.jsxs("div",{className:"mt-10 inline-flex items-center gap-4",children:[e.jsx("button",{type:"button",onClick:a,className:"inline-flex w-full justify-center rounded-md bg-[#DDDDDD] text-black px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-[#B6B6B6] hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Huỷ"}),e.jsx("button",{type:"submit",disabled:j,className:"inline-flex w-full justify-center rounded-md bg-primary text-white px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Tạo danh mục"})]})]})},X=({id:a,close:d})=>{const y=T(),{register:o,setValue:c,trigger:m,handleSubmit:p,formState:{errors:u}}=q(),f=i=>{if(i.target.files){j(i.target.files[0]);const w=new FileReader;w.readAsDataURL(i.target.files[0]),w.onload=()=>t(w.result)}},{data:r,isLoading:b}=S({queryKey:["category",{id:a}],queryFn:()=>Z(Number(a))}),[l,j]=v.useState(null),[x,t]=v.useState("");v.useEffect(()=>{r&&(c("name",r.name,{shouldDirty:!0}),c("thumbnail",r.thumbnail,{shouldDirty:!0}),t(r.thumbnail))},[r]);const{mutate:s,isLoading:n}=B(J,{onSuccess:i=>{i.success?(h(g.success,"Cập nhật danh mục thành công!","success"),y.invalidateQueries({queryKey:["categories"]}),d()):h(g.error,i.message)}}),H=async i=>{console.log(i);const{name:w,thumbnail:C}=i,N=new FormData;N.append("name",w),N.append("thumbnail",l?null:C),N.append("newThumbnail",l),s({id:a,payload:N})};return b?e.jsx(M,{loadInside:!0}):e.jsxs("form",{onSubmit:async i=>{var C;if(i.preventDefault(),!await m())for(let N in u)return h(g.error,(C=u[N])==null?void 0:C.message);if(!x&&!l)return h(g.error,A);p(H)()},children:[e.jsxs("div",{className:"w-full flex flex-col justify-between bg-white dark:bg-form-strokedark p-4 gap-8 leading-normal",children:[e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Tên danh mục ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsx("input",{...o("name",{required:"Tên danh mục không được bỏ trống",value:r&&r.name}),type:"text",className:"w-full rounded-lg border-[1.5px] border-stroke bg-gray py-3 px-5 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"})]}),e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Hình ảnh ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsxs("div",{className:"w-full inline-flex items-center gap-4",children:[x&&e.jsx("img",{src:x,className:"w-16 h-16",alt:"preview-thumb"}),e.jsxs("label",{htmlFor:"create-cate",className:"px-3 py-1 rounded-lg bg-primary text-white",children:["Tải ảnh",e.jsx("input",{type:"file",onChange:f,id:"create-cate",className:"sr-only"})]})]})]})]}),e.jsxs("div",{className:"mt-10 inline-flex items-center gap-4",children:[e.jsx("button",{type:"button",onClick:()=>{t(""),j(null),d()},className:"inline-flex w-full justify-center rounded-md bg-[#DDDDDD] text-black px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-[#B6B6B6] hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Huỷ"}),e.jsx("button",{type:"submit",disabled:n,className:"inline-flex w-full justify-center rounded-md bg-primary text-white px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Cập nhật danh mục"})]})]})};export{re as default};
