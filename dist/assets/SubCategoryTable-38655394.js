import{Z as E,g as V,$ as R,i as q,O as K,u as O,a as U,b as z,c as Q,R as S,j as e,L as D,P as L,k as I,n as f,E as y,e as Z}from"./index-28192e3f.js";import{P as G}from"./Pagination-069b2076.js";import{c as u,q as J,u as T,a as A}from"./base-a6ef644b.js";import{a as W}from"./category.query-e5221d87.js";import{u as X,F as M,a as P}from"./index.esm-62b15f1a.js";import{M as B}from"./Modal-214bacdf.js";const Y=async s=>await E(`${u.endpoint}/sub-category`,s,{Authorization:`Bearer ${V(u.cache.accessToken)}`}),_=async s=>await R(`${u.endpoint}/sub-category/${s.id}`,s.payload,{Authorization:`Bearer ${V(u.cache.accessToken)}`}),ee=async(s,r,h)=>{const x=J.stringify({page:s,limit:r},{skipNull:!0,skipEmptyString:!0}),i=await q(`${u.endpoint}/sub-category/category/${h}?${x}`,{Authorization:`Bearer ${V(u.cache.accessToken)}`});if(i.success)return i.data},te=async s=>{const r=await q(`${u.endpoint}/sub-category/${s}`,{Authorization:`Bearer ${V(u.cache.accessToken)}`});if(r.success)return r.data.subCategory},$="Ảnh danh mục phụ không được bỏ trống!",de=({title:s})=>{var t,c,l;const{id:r}=K(),{search:h}=O(),x=U(),i=z(d=>d.common),j=Q(),p=X(),[w,N]=S.useState(""),k=new URLSearchParams(h),g=Number(k.get("page"))||u.pagination.PAGE,n=Number(k.get("limit"))||u.pagination.LIMIT,a=T({queryKey:["category"],queryFn:()=>W(Number(r))}),o=T({queryKey:["subCategories",{page:g,limit:n}],queryFn:()=>ee(g,n,Number(r)),enabled:!a.isLoading&&!a.isError&&a.isFetched}),v=o.data&&o.data.totalSubCategory,b=()=>{p.reset(),j(Z())};return(a.isError||o.isError)&&x(-1),a.isLoading?e.jsx(D,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-10 mb-6",children:e.jsxs("div",{className:"w-full inline-flex items-center justify-between",children:[e.jsxs("h4",{className:"text-xl font-semibold text-black dark:text-white",children:[s," ",">"," ",(t=a.data)==null?void 0:t.name]}),e.jsx("div",{className:"inline-flex items-center gap-4",children:e.jsxs("button",{type:"button",className:"text-black bg-[#FBE69E] hover:bg-[#FFC700]/90 focus:ring-2 focus:outline-none focus:ring-[#FFC700]/50 font-medium rounded-lg text-xs px-5 py-2.5 text-center inline-flex items-center dark:focus:ring-[#3b5998]/55",onClick:()=>{N("create"),j(L({id:0,isOpen:!0}))},children:["Tạo danh mục phụ",e.jsx("svg",{className:"w-4 h-4 ml-4","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"})})]})})]})}),o.isRefetching?e.jsx(D,{loadInside:!0}):e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"grid grid-cols-4 border-stroke py-4 dark:border-strokedark sm:grid-cols-4",children:[e.jsx("div",{className:"col-span-1",children:e.jsx("h5",{className:"text-sm font-bold xsm:text-base",children:"Hình ảnh"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h5",{className:"text-sm font-bold xl:text-base",children:"Danh mục phụ"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h5",{className:"text-sm text-center font-bold xl:text-base",children:"Số lượng sản phẩm"})}),e.jsx("div",{className:"col-span-1",children:e.jsx("h5",{className:"text-sm text-center font-bold xsm:text-base",children:"Hành động"})})]}),((c=o.data)==null?void 0:c.subCategories.length)>0&&((l=o.data)==null?void 0:l.subCategories.map(d=>e.jsxs("div",{className:"grid grid-cols-4 border-t border-stroke py-4 dark:border-strokedark sm:grid-cols-4",children:[e.jsx("img",{className:"col-span-1 w-14 rounded-md",src:d.thumbnail,alt:"subCategory"}),e.jsx("div",{className:"flex flex-col gap-2 justify-center",children:e.jsx("p",{className:"text-xs font-semibold text-black dark:text-white text-ellipsis overflow-hidden",children:d.name})}),e.jsx("div",{className:"col-span-1 flex justify-center items-center",children:e.jsx("p",{className:"text-xs text-center text-black dark:text-white",children:d.totalProduct})}),e.jsxs("div",{className:"col-span-1 inline-flex items-center justify-center gap-2",children:[e.jsx("button",{type:"button",onClick:()=>{N("update"),j(L({id:d.id,isOpen:!0}))},className:"hover:text-primary",children:e.jsx("svg",{className:"fill-current",width:24,height:24,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M5,3C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V12H19V19H5V5H12V3H5M17.78,4C17.61,4 17.43,4.07 17.3,4.2L16.08,5.41L18.58,7.91L19.8,6.7C20.06,6.44 20.06,6 19.8,5.75L18.25,4.2C18.12,4.07 17.95,4 17.78,4M15.37,6.12L8,13.5V16H10.5L17.87,8.62L15.37,6.12Z"})})}),e.jsx("button",{type:"button",className:"hover:text-primary",children:e.jsx("svg",{className:"fill-current",width:24,height:24,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z"})})})]})]},d.id))),v>0&&e.jsx("div",{className:"flex justify-center items-center my-4",children:e.jsx(G,{page:g,limit:n,total:v})}),i.isOpenModal&&w==="create"&&i.modalId===0&&e.jsx(M,{...p,children:e.jsx(B,{title:"Tạo danh mục phụ",body:e.jsx(se,{cateId:a.data.id,cateName:a.data.name,close:b}),isForm:!0})}),i.isOpenModal&&w==="update"&&i.modalId>0&&e.jsx(M,{...p,children:e.jsx(B,{title:"Cập nhật danh mục phụ",body:e.jsx(ae,{id:i.modalId,cateId:a.data.id,cateName:a.data.name,close:b}),isForm:!0})})]})]})},se=({cateId:s,cateName:r,close:h})=>{const x=I(),{register:i,trigger:j,handleSubmit:p,formState:{errors:w}}=P(),[N,k]=S.useState(null),[g,n]=S.useState(""),a=t=>{if(t.target.files){k(t.target.files[0]);const c=new FileReader;c.onload=()=>n(c.result),c.readAsDataURL(t.target.files[0])}},{mutate:o,isLoading:v}=A(Y,{onSuccess:t=>{t.success?(f(y.success,"Tạo mới danh mục phụ thành công!","success"),x.invalidateQueries({queryKey:["subCategories"]}),h()):f(y.error,t.message)}}),b=async t=>{const{name:c}=t,l=new FormData;l.append("categoryId",s),l.append("name",c),l.append("thumbnail",N),o(l)};return e.jsxs("form",{onSubmit:async t=>{var l;if(t.preventDefault(),!await j())for(let d in w)return f(y.error,(l=w[d])==null?void 0:l.message);if(!N)return f(y.error,$);p(b)()},children:[e.jsxs("div",{className:"w-full flex flex-col justify-between bg-white dark:bg-form-strokedark p-4 gap-8 leading-normal",children:[e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsx("p",{className:"w-1/4 text-sm text-left",children:"Tên danh mục chính"}),e.jsx("input",{type:"text",defaultValue:r,disabled:!0,className:"w-full rounded-lg border-[1.5px] border-stroke bg-gray py-3 px-5 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"})]}),e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Tên danh mục phụ ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsx("input",{...i("name",{required:"Tên danh mục phụ không được bỏ trống"}),type:"text",className:"w-full rounded-lg border-[1.5px] border-stroke bg-gray py-3 px-5 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"})]}),e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Hình ảnh ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsxs("div",{className:"w-full inline-flex items-center gap-4",children:[g&&e.jsx("img",{src:g,className:"w-16 h-16",alt:"preview-thumb"}),e.jsxs("label",{htmlFor:"create-cate",className:"px-3 py-1 rounded-lg bg-primary text-white",children:["Tải ảnh",e.jsx("input",{type:"file",onChange:a,id:"create-cate",className:"sr-only"})]})]})]})]}),e.jsxs("div",{className:"mt-10 inline-flex items-center gap-4",children:[e.jsx("button",{type:"button",onClick:h,className:"inline-flex w-full justify-center rounded-md bg-[#DDDDDD] text-black px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-[#B6B6B6] hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Huỷ"}),e.jsx("button",{type:"submit",disabled:v,className:"inline-flex w-full justify-center rounded-md bg-primary text-white px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Tạo danh mục"})]})]})},ae=({id:s,cateId:r,cateName:h,close:x})=>{const i=I(),{register:j,setValue:p,trigger:w,handleSubmit:N,formState:{errors:k}}=P(),g=m=>{if(m.target.files){v(m.target.files[0]);const H=new FileReader;H.onload=()=>t(H.result),H.readAsDataURL(m.target.files[0])}},{data:n,isLoading:a}=T({queryKey:["subcategory",{id:s}],queryFn:()=>te(Number(s))}),[o,v]=S.useState(),[b,t]=S.useState("");S.useEffect(()=>{n&&(p("name",n.name,{shouldDirty:!0}),p("thumbnail",n.thumbnail,{shouldDirty:!0}),t(n.thumbnail))},[n]);const{mutate:c,isLoading:l}=A(_,{onSuccess:m=>{m.success?(f(y.success,"Cập nhật danh mục phụ thành công!","success"),i.invalidateQueries({queryKey:["subCategories"]}),x()):f(y.error,m.message)}}),d=async m=>{const{name:H,thumbnail:F}=m,C=new FormData;C.append("categoryId",r.toString()),C.append("name",H),C.append("thumbnail",o?null:F),C.append("newThumbnail",o),c({id:s,payload:C})};return a?e.jsx(D,{loadInside:!0}):e.jsxs("form",{onSubmit:async m=>{var F;if(m.preventDefault(),!await w())for(let C in k)return f(y.error,(F=k[C])==null?void 0:F.message);if(!b&&!o)return f(y.error,$);N(d)()},children:[e.jsxs("div",{className:"w-full flex flex-col justify-between bg-white dark:bg-form-strokedark p-4 gap-8 leading-normal",children:[e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsx("p",{className:"w-1/4 text-sm text-left",children:"Tên danh mục chính"}),e.jsx("input",{type:"text",defaultValue:h,disabled:!0,className:"w-full rounded-lg border-[1.5px] border-stroke bg-gray py-3 px-5 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"})]}),e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Tên danh mục ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsx("input",{...j("name",{required:"Tên danh mục không được bỏ trống",value:n&&n.name}),type:"text",className:"w-full rounded-lg border-[1.5px] border-stroke bg-gray py-3 px-5 font-medium outline-none transition focus:border-primary active:border-primary disabled:cursor-default disabled:bg-whiter dark:border-form-strokedark dark:bg-form-input dark:focus:border-primary"})]}),e.jsxs("div",{className:"inline-flex items-center gap-4",children:[e.jsxs("p",{className:"w-1/4 text-sm text-left",children:["Hình ảnh ",e.jsx("span",{className:"text-meta-1",children:"*"})]}),e.jsxs("div",{className:"w-full inline-flex items-center gap-4",children:[b&&e.jsx("img",{src:b,className:"w-16 h-16",alt:"preview-thumb"}),e.jsxs("label",{htmlFor:"create-cate",className:"px-3 py-1 rounded-lg bg-primary text-white",children:["Tải ảnh",e.jsx("input",{type:"file",onChange:g,id:"create-cate",className:"sr-only"})]})]})]})]}),e.jsxs("div",{className:"mt-10 inline-flex items-center gap-4",children:[e.jsx("button",{type:"button",onClick:()=>{t(""),v(null),x()},className:"inline-flex w-full justify-center rounded-md bg-[#DDDDDD] text-black px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-[#B6B6B6] hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Huỷ"}),e.jsx("button",{type:"submit",disabled:l,className:"inline-flex w-full justify-center rounded-md bg-primary text-white px-3 py-2 text-sm font-semibold shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:"Cập nhật danh mục"})]})]})};export{de as default};
